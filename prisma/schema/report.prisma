import { AttachmentEntity, ReportStatus } from "enums"

model Report {
    id         Int          @id @unique @default(autoincrement())
    name       String       @db.VarChar(256)
    startDate  DateTime     @default(now()) @db.Date
    finishDate DateTime?    @db.Date
    status     ReportStatus @default(CREATED)
    userId     Int          @map("user_id")
    updateById Int?
    createdAt  DateTime     @default(now()) @map("created_at") @db.Timestamp()
    updatedAt  DateTime?    @map("updated_at") @db.Timestamp()

    @@unique([name, userId, startDate, finishDate])
    @@map("report")
}

model Category {
    id        Int      @id @unique @default(autoincrement())
    name      String   @db.VarChar(256)
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamp()

    @@map("category")
}

model ReportProperty {
    id           Int      @id @unique @default(autoincrement())
    reportId     Int      @map("report_id")
    goalExpenses Decimal  @map("goal_expenses")
    goalIncome   Decimal? @map("goal_income")

    @@map("report_property")
}

model SharedReport {
    id           Int       @id @unique @default(autoincrement())
    userId       Int       @map("user_id")
    reportId     Int       @map("report_id")
    permissionId Int       @map("permission_id")
    createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamp()
    updatedAt    DateTime? @map("updated_at") @db.Timestamp()

    @@unique([userId, reportId])
    @@index([userId])
    @@map("shared_report")
}

model PermissionReport {
    id        Int      @id @unique @default(autoincrement())
    name      String   @unique @db.VarChar(256)
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamp()

    @@map("permission_report")
}

model Expense {
    id          Int       @id @unique @default(autoincrement())
    name        String    @db.VarChar(256)
    description String?
    userId      Int       @map("user_id")
    categoryId  Int?      @map("category_id")
    active      Boolean   @default(true)
    amount      Decimal   @db.Decimal(15, 2)
    createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamp()
    updatedAt   DateTime? @map("updated_at") @db.Timestamp()

    @@unique([name, userId])
    @@map("expense")
}

model Income {
    id          Int       @id @unique @default(autoincrement())
    name        String    @db.VarChar(256)
    description String?
    amount      Decimal   @db.Decimal(15, 2)
    userId      Int       @map("user_id")
    active      Boolean   @default(true)
    createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamp()
    updatedAt   DateTime? @map("updated_at") @db.Timestamp()

    @@unique([name, userId])
    @@map("income")
}

model ReportExpense {
    id              Int       @id @unique @default(autoincrement())
    reportId        Int       @map("report_id")
    reportedDate    DateTime  @default(now()) @map("reported_date") @db.Timestamp()
    nameExpense     String    @map("name_expense") @db.VarChar(256)
    expenseAmount   Decimal   @map("expense_amount") @db.Decimal(15, 2)
    parentExpenseId Int?      @map("parent_expense_id")
    active          Boolean   @default(true)
    updateById      Int?
    createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamp()
    updatedAt       DateTime? @map("updated_at") @db.Timestamp()

    @@index([reportId, reportedDate])
    @@map("report_expense")
}

model ReportExpenseProperty {
    id              Int     @id @unique @default(autoincrement())
    reportExpenseId Int     @map("report_expense_id")
    description     String?
    categoryId      Int?    @map("category_id")

    @@map("report_expense_property")
}

model ReportExpenseComment {
    id              Int       @id @unique @default(autoincrement())
    reportExpenseId Int       @map("report_expense_id")
    comment         String
    userId          Int       @map("user_id")
    parentCommentId Int?      @map("parent_comment_id")
    createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamp()
    updatedAt       DateTime? @map("updated_at") @db.Timestamp()

    @@index([reportExpenseId, parentCommentId])
    @@map("report_expense_comment")
}

model ReportAttachment {
    id              Int              @id @unique @default(autoincrement())
    reportId        Int              @map("report_id")
    url             String           @db.VarChar(512)
    name            String           @db.VarChar(256)
    uploadedBy      Int              @map("uploaded_by")
    relatedEntity   AttachmentEntity @map("related_entity")
    relatedEntityId Int              @map("related_entity_id")
    createdAt       DateTime         @default(now()) @map("created_at") @db.Timestamp()

    @@map("report_attachment")
}

model ReportIncome {
    id             Int       @id @unique @default(autoincrement())
    reportId       Int       @map("report_id")
    reportedDate   DateTime  @default(now()) @map("reported_date") @db.Timestamp()
    nameIncome     String    @map("name_income") @db.VarChar(256)
    incomeAmount   Decimal   @map("income_amount") @db.Decimal(15, 2)
    parentIncomeId Int?      @map("parent_income_id")
    description    String?
    active         Boolean   @default(true)
    updateById     Int?
    createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamp()
    updatedAt      DateTime? @map("updated_at") @db.Timestamp()

    @@index([reportId, reportedDate])
    @@map("report_income")
}

model ReportIncomeComment {
    id              Int       @id @unique @default(autoincrement())
    reportIncomeId  Int       @map("report_income_id")
    comment         String
    userId          Int       @map("user_id")
    parentCommentId Int?      @map("parent_comment_id")
    createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamp()
    updatedAt       DateTime? @map("updated_at") @db.Timestamp()

    @@index([reportIncomeId, parentCommentId])
    @@map("report_income_comment")
}
